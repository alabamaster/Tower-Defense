/* Plugin generated by AMXX-Studio */

#include <amxmodx>
#include <amxmisc>
#include <td>

#define PLUGIN "Tower Defense: Countdown Speaker"
#define VERSION "1.0"
#define AUTHOR "GT Team"

new g_MinSec
new gSeconds;

public plugin_init() {
	register_plugin(PLUGIN, VERSION, AUTHOR)
	
	g_MinSec = register_cvar("td_countdown_speak_min_sec", "10")
	set_task(10.0, "td_endwave")
}
public td_endwave(wave)
	gSeconds = get_cvar_num("td_time_to_wave")
	
public td_countdown_started(iToWhichWave) {
	new iTimeWave = get_cvar_num("td_time_to_wave") 
	new vMinSec = get_pcvar_num(g_MinSec)
	client_print(0,3, "1 %d %d %d", iToWhichWave, gSeconds, vMinSec)
	if(iTimeWave <= 0 || vMinSec > iTimeWave) {
		return PLUGIN_CONTINUE
	}
	
	else if(vMinSec < 3 || vMinSec > 10)  {
		server_print("TD:Countdown Speaker| Nie bede odtwarzal dzwieku jesli cvar jest mniejszy niz 3 albo wiekszy niz 10")
		return PLUGIN_CONTINUE
	}
	client_print(0,3, "2 %d %d %d", iTimeWave, gSeconds, vMinSec)
	if(gSeconds-1 > vMinSec) {
		gSeconds--
		set_task(1.0, "td_countdown_started", iToWhichWave)
		return PLUGIN_CONTINUE
	}
	client_print(0,3, "3 %d %d %d", iTimeWave, gSeconds, vMinSec)
	Speak(vMinSec+1)
	
	return PLUGIN_CONTINUE
}

public Speak(noSound) {
	noSound--
	
	switch(noSound) {
		case 10:client_cmd(0, "spk ten")
		case 9: client_cmd(0, "spk nine")
		case 8: client_cmd(0, "spk eight")
		case 7: client_cmd(0, "spk seven")
		case 6: client_cmd(0, "spk six")
		case 5: client_cmd(0, "spk five")
		case 4: client_cmd(0, "spk four")
		case 3: client_cmd(0, "spk three")
		case 2: client_cmd(0, "spk two")
		case 1: client_cmd(0, "spk one")
	}
	if(noSound == 1) {
		remove_task(noSound+1)
		return PLUGIN_CONTINUE
	}
	set_task(1.0, "Speak", noSound)
	
	return PLUGIN_CONTINUE
}
